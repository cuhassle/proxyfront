<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VS Browser Pro</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #1e1e1e;
      color: #fff;
      height: 100%;
      overflow: hidden;
    }

    #browserContainer {
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
    }

    /* Tab Bar */
    .tab-bar {
      display: flex;
      align-items: center;
      background: #2d2d2d;
      padding: 4px;
    }

    .tabs-container {
      display: flex;
      flex: 1;
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .tab {
      background: #3c3c3c;
      padding: 6px 12px;
      margin-right: 4px;
      border-radius: 4px 4px 0 0;
      cursor: pointer;
      white-space: nowrap;
      display: flex;
      align-items: center;
      max-width: 200px;
    }

    .tab.active {
      background: #1e90ff;
      color: #fff;
    }

    .tab span {
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tab .close-btn {
      margin-left: 8px;
      cursor: pointer;
      color: #ccc;
    }

    .new-tab {
      background: #3c3c3c;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      cursor: pointer;
      color: #fff;
      font-size: 18px;
    }

    /* Toolbar */
    .toolbar {
      display: flex;
      align-items: center;
      padding: 4px;
      background: #252526;
    }

    .nav-buttons {
      display: flex;
      gap: 4px;
    }

    .nav-button {
      background: #3c3c3c;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      cursor: pointer;
      color: #fff;
    }

    .nav-button:disabled {
      opacity: 0.5;
      cursor: default;
    }

    .address-bar {
      flex: 1;
      margin: 0 8px;
    }

    .address-bar input {
      width: 100%;
      padding: 6px;
      border: none;
      border-radius: 4px;
      outline: none;
    }

    /* Webview Container */
    .webview-container {
      flex: 1;
      position: relative;
      background: #fff;
    }

    .webview-container iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: none;
    }

    .webview-container iframe.active {
      display: block;
    }

    /* Status Bar */
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #2d2d2d;
      padding: 4px 8px;
      font-size: 12px;
    }

    /* Loading Indicator */
    .loading-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      flex-direction: column;
      align-items: center;
      color: #000;
    }

    .loading-indicator.active {
      display: flex;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #1e90ff;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Error Page */
    .error-page {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: absolute;
      inset: 0;
      background: #fff;
      color: #000;
      text-align: center;
      padding: 20px;
    }

    .error-page.active {
      display: flex;
    }

    .error-icon {
      font-size: 40px;
      margin-bottom: 10px;
    }

    .error-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .retry-button {
      background: #1e90ff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      cursor: pointer;
      margin-top: 10px;
    }

    .retry-button:hover {
      background: #0066cc;
    }
  </style>
</head>
<body>
  <div id="browserContainer">
    <!-- Tab Bar -->
    <div class="tab-bar">
      <div class="tabs-container" id="tabsContainer"></div>
      <button id="newTabBtn" class="new-tab" title="New Tab">+</button>
    </div>

    <!-- Toolbar -->
    <div class="toolbar">
      <div class="nav-buttons">
        <button id="backBtn" class="nav-button" title="Back" disabled>‚Äπ</button>
        <button id="forwardBtn" class="nav-button" title="Forward" disabled>‚Ä∫</button>
        <button id="refreshBtn" class="nav-button" title="Refresh">‚Üª</button>
      </div>
      <div class="address-bar">
        <input type="text" id="addressBar" placeholder="Enter URL or search...">
      </div>
      <button id="goBtn" class="nav-button" title="Go">Go</button>
    </div>

    <!-- Webview Container -->
    <div class="webview-container" id="webviewContainer">
      <div class="loading-indicator" id="loadingIndicator">
        <div class="spinner"></div>
        <div class="loading-text">Loading...</div>
      </div>
      <div class="error-page" id="errorPage">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-title">Page couldn't load</div>
        <div class="error-message">Check your connection or try a different URL</div>
        <button class="retry-button" onclick="retryCurrentPage()">Try Again</button>
      </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar" id="statusBar">
      <div class="status-left">
        <span id="statusText">Ready</span>
        <span id="tabCount">1 tab</span>
      </div>
      <div class="status-right">
        <span id="securityIndicator" class="security-indicator">üîí Secure</span>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Load all required Ultraviolet scripts -->
  <script src="/active/uv/uv.bundle.js" defer></script>
  <script src="/active/uv/uv.handler.js" defer></script>
  <script src="/active/uv/uv.client.js" defer></script>
  <script src="/active/uv/uv.config.js" defer></script>
  <script src="/assets/js/register.js" defer></script>

  <script>
    const HOMEPAGE = 'https://duckduckgo.com';
    let tabs = [];
    let activeTabId = null;
    let tabCounter = 0;
    const tabHistories = new Map();

    // DOM elements
    const tabsContainer = document.getElementById('tabsContainer');
    const webviewContainer = document.getElementById('webviewContainer');
    const newTabBtn = document.getElementById('newTabBtn');
    const addressBar = document.getElementById('addressBar');
    const backBtn = document.getElementById('backBtn');
    const forwardBtn = document.getElementById('forwardBtn');
    const refreshBtn = document.getElementById('refreshBtn');
    const goBtn = document.getElementById('goBtn');
    const statusText = document.getElementById('statusText');
    const tabCount = document.getElementById('tabCount');
    const securityIndicator = document.getElementById('securityIndicator');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const errorPage = document.getElementById('errorPage');

    function encodeUrl(input) {
      if (!input) return '';
      if (input.startsWith('http://') || input.startsWith('https://')) {
        return __uv$config.prefix + __uv$config.encodeUrl(input);
      }
      if (input.includes(' ') || !input.includes('.')) {
        const searchUrl = `https://duckduckgo.com/?q=${encodeURIComponent(input)}`;
        return __uv$config.prefix + __uv$config.encodeUrl(searchUrl);
      }
      return __uv$config.prefix + __uv$config.encodeUrl('https://' + input);
    }

    function init() {
      setupEventListeners();
      createNewTab(HOMEPAGE);
      updateUI();
    }

    function setupEventListeners() {
      newTabBtn.addEventListener('click', () => createNewTab(HOMEPAGE));
      goBtn.addEventListener('click', () => navigateToUrl(addressBar.value));
      addressBar.addEventListener('keydown', e => {
        if (e.key === 'Enter') navigateToUrl(addressBar.value);
      });
      backBtn.addEventListener('click', () => goBack());
      forwardBtn.addEventListener('click', () => goForward());
      refreshBtn.addEventListener('click', () => refreshPage());
    }

    function createNewTab(url) {
      const tabId = `tab-${tabCounter++}`;
      const iframe = document.createElement('iframe');
      iframe.className = 'webview';
      iframe.dataset.tabId = tabId;
      webviewContainer.appendChild(iframe);

      const tab = document.createElement('div');
      tab.className = 'tab';
      tab.dataset.tabId = tabId;
      tab.innerHTML = `<span>New Tab</span><span class="close-btn">‚úï</span>`;
      tabsContainer.appendChild(tab);

      tabs.push(tabId);
      tabHistories.set(tabId, { history: [], index: -1 });

      tab.addEventListener('click', e => {
        if (e.target.classList.contains('close-btn')) {
          closeTab(tabId);
        } else {
          switchTab(tabId);
        }
      });

      switchTab(tabId);
      navigateToUrl(url);
    }

    function switchTab(tabId) {
      activeTabId = tabId;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('iframe').forEach(f => f.classList.remove('active'));
      const tab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
      const iframe = document.querySelector(`iframe[data-tab-id="${tabId}"]`);
      if (tab) tab.classList.add('active');
      if (iframe) iframe.classList.add('active');
      updateUI();
    }

    function navigateToUrl(url) {
      if (!activeTabId) return;
      const iframe = document.querySelector(`iframe[data-tab-id="${activeTabId}"]`);
      if (!iframe) return;

      const encoded = encodeUrl(url);
      if (!encoded) return;

      const tabHistory = tabHistories.get(activeTabId);
      if (tabHistory) {
        tabHistory.history = tabHistory.history.slice(0, tabHistory.index + 1);
        tabHistory.history.push(url);
        tabHistory.index++;
      }

      iframe.src = encoded;
      addressBar.value = url;
      showLoading(true);
      statusText.textContent = `Loading ${url}...`;

      iframe.onload = () => handleLoadSuccess(url);
      iframe.onerror = () => handleLoadError();
    }

    function handleLoadSuccess(url) {
      showLoading(false);
      errorPage.classList.remove('active');
      const tab = document.querySelector(`.tab[data-tab-id="${activeTabId}"] span:first-child`);
      if (tab) tab.textContent = url;
      statusText.textContent = `Loaded ${url}`;
      securityIndicator.textContent = url.startsWith('https') ? 'üîí Secure' : '‚ö†Ô∏è Not Secure';
      updateUI();
    }

    function handleLoadError() {
      showLoading(false);
      errorPage.classList.add('active');
      statusText.textContent = "Failed to load page";
      securityIndicator.textContent = '‚ö†Ô∏è Error';
    }

    function retryCurrentPage() {
      if (!activeTabId) return;
      const tabHistory = tabHistories.get(activeTabId);
      if (tabHistory && tabHistory.index >= 0) {
        navigateToUrl(tabHistory.history[tabHistory.index]);
      }
    }

    function goBack() {
      if (!activeTabId) return;
      const tabHistory = tabHistories.get(activeTabId);
      if (tabHistory && tabHistory.index > 0) {
        tabHistory.index--;
        navigateToUrl(tabHistory.history[tabHistory.index]);
      }
    }

    function goForward() {
      if (!activeTabId) return;
      const tabHistory = tabHistories.get(activeTabId);
      if (tabHistory && tabHistory.index < tabHistory.history.length - 1) {
        tabHistory.index++;
        navigateToUrl(tabHistory.history[tabHistory.index]);
      }
    }

    function refreshPage() {
      if (!activeTabId) return;
      const tabHistory = tabHistories.get(activeTabId);
      if (tabHistory && tabHistory.index >= 0) {
        navigateToUrl(tabHistory.history[tabHistory.index]);
      }
    }

    function closeTab(tabId) {
      const tab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
      const iframe = document.querySelector(`iframe[data-tab-id="${tabId}"]`);
      if (tab) tab.remove();
      if (iframe) iframe.remove();
      tabs = tabs.filter(t => t !== tabId);
      tabHistories.delete(tabId);
      if (activeTabId === tabId) {
        if (tabs.length > 0) {
          switchTab(tabs[tabs.length - 1]);
        } else {
          activeTabId = null;
        }
      }
      updateUI();
    }

    function showLoading(show) {
      loadingIndicator.classList.toggle('active', show);
    }

    function updateUI() {
      const tabHistory = tabHistories.get(activeTabId);
      backBtn.disabled = !tabHistory || tabHistory.index <= 0;
      forwardBtn.disabled = !tabHistory || tabHistory.index >= tabHistory.history.length - 1;
      tabCount.textContent = `${tabs.length} tab${tabs.length !== 1 ? 's' : ''}`;
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
